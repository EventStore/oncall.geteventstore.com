define(["libs/knockout"],function(a){return a.components.register("support-agents-widget",{viewModel:{require:"components/SupportAgents/SupportAgents"},template:{require:"text!components/SupportAgents/SupportAgents.html"}}),a.components.register("calendar-widget",{viewModel:{require:"components/Calendar/Calendar"},template:{require:"text!components/Calendar/Calendar.html"}}),a.components.register("login-widget",{viewModel:{require:"components/Login/Login"},template:{require:"text!components/Login/Login.html"}}),a.components.register("ticket-widget",{viewModel:{require:"components/TicketList/TicketList"},template:{require:"text!components/TicketList/TicketList.html"}}),function(){function b(a,b){var c=new XMLHttpRequest;c.open("PUT",window.Config.APIBaseUrl+"schedule/range/?DateStart="+a+"&DateEnd="+b,!0),c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Authorization",userAccessKey),c.onload=function(){this.status>=200&&this.status<400?(e.errorMessages.push("Success: "+this.responseText),e.isSuccess(!0)):(e.errorMessages.push(this.responseText),e.isSuccess(!1))},c.onerror=function(){};var d={supportAgentName:e.selectedAgentName(),supportAgentId:e.selectedAgentId(),supportAgentColour:e.selectedAgentColour()};console.log(JSON.stringify(d)),c.send(JSON.stringify(d)),e.isLoading(!0)}function c(a,b){var c=new XMLHttpRequest;c.open("DELETE",window.Config.APIBaseUrl+"schedule/range/?DateStart="+a+"&DateEnd="+b,!0),c.setRequestHeader("Accept","application/json"),c.setRequestHeader("Authorization",userAccessKey),c.onload=function(){this.status>=200&&this.status<400?(e.errorMessages.push("Success: "+this.responseText),e.isSuccess(!0)):(e.errorMessages.push(this.responseText),e.isSuccess(!1))},c.onerror=function(){};var d={supportAgentId:e.selectedAgentId()};c.send(JSON.stringify(d)),e.isLoading(!0)}function d(){var a=new XMLHttpRequest;a.open("GET",window.Config.APIBaseUrl+"info",!0),a.setRequestHeader("Accept","application/json"),a.onload=function(){if(this.status>=200&&this.status<400){var a=JSON.parse(this.response);console.log(a),e.ticketsActive(a.ticketsActive),e.ticketsNearSla(a.ticketsNearSla),e.currentlyOnCall(a.currentlyOnCall)}else e.ticketsActive("--"),e.ticketsNearSla("--"),e.currentlyOnCall("Unknown")},a.onerror=function(){},a.send()}var e=this;e.selectedAgentId=a.observable(),e.isLoading=a.observable(!1),e.isLoggedIn=a.observable(!1),e.showTickets=a.observable(!1),e.selectedAgentName=a.observable(),e.selectedAgentColour=a.observable(),e.ticketsActive=a.observable(),e.ticketsNearSla=a.observable(),e.currentlyOnCall=a.observable(),e.selectedDates=a.observableArray([]),e.errorMessages=a.observableArray([]),e.showErrors=a.computed(function(){return e.errorMessages().length>0?!0:!1}),e.isSuccess=a.observable(!1),d(),e.agentSelectionChanged=function(a,b,c){e.selectedAgentId(a),e.selectedAgentName(b),e.selectedAgentColour(c)},e.dateSelectionChanged=function(a){e.selectedDates(a)},e.canSave=a.computed(function(){return e.selectedDates().length>0}),e.logout=function(){userAccessKey="",e.isLoggedIn(!1)},e.canLogin=function(a){e.isLoggedIn(a)},e.addSelectedDates=function(){e.selectedDates.sort(function(a,b){return a.dateTime==b.dateTime?0:a.dateTime<b.dateTime?-1:1});var a=moment(e.selectedDates()[0].dateTime).date()+"-"+(moment(e.selectedDates()[0].dateTime).month()+1)+"-"+moment(e.selectedDates()[0].dateTime).year(),c=e.selectedDates().length,d=moment(e.selectedDates()[c-1].dateTime).date()+"-"+(moment(e.selectedDates()[c-1].dateTime).month()+1)+"-"+moment(e.selectedDates()[c-1].dateTime).year();b(a,d),e.selectedDates([]),setTimeout(function(){e.isLoading(!1)},500)},e.removeSelectedDates=function(){e.selectedDates.sort(function(a,b){return a.dateTime==b.dateTime?0:a.dateTime<b.dateTime?-1:1});var a=moment(e.selectedDates()[0].dateTime).date()+"-"+(moment(e.selectedDates()[0].dateTime).month()+1)+"-"+moment(e.selectedDates()[0].dateTime).year(),b=e.selectedDates().length,d=moment(e.selectedDates()[b-1].dateTime).date()+"-"+(moment(e.selectedDates()[b-1].dateTime).month()+1)+"-"+moment(e.selectedDates()[b-1].dateTime).year();c(a,d),e.selectedDates([]),setTimeout(function(){e.isLoading(!1)},500)}}});